# Домашнее задание к занятию «Микросервисы: принципы»

> Репозиторий: hw-32\
> Выполнил: Асадбек Асадбеков\
> Дата: август 2025

## Структура проекта

```
microservices-principles/
├── api-gateway/
│   └── comparison-table.md
├── message-broker/
│   └── comparison-table.md
└── task-3/
    ├── docker-compose.yml
    └── nginx/
        └── conf.d/
            └── api_gateway.conf
```

![Структура проекта](https://github.com/asad-bekov/hw-32/blob/main/img/1.PNG)

---

## Архитектура решения

### Задача 1: Сравнительный анализ API Gateway

**Выбор:** **Nginx**  
**Причины:**
- Проверенная надежность  
- Высокая производительность  
- Простая конфигурация для учебного проекта  
- Отличная документация  

**Сравнительная таблица:**

| Критерий            | Nginx                | Traefik        | Kong               |
|----------------------|----------------------|----------------|--------------------|
| **Маршрутизация**   | Отличная             | Отличная       | Отличная           |
| **Аутентификация**  | Базовая + Lua        | Middleware     | **Превосходная**   |
| **HTTPS терминация**| ✅                   | ✅             | ✅                 |
| **Простота**        | Средняя              | **Высокая**    | Средняя            |
| **Производительность** | **Очень высокая** | Высокая        | Высокая            |

---

### Задача 2: Сравнительный анализ Брокеров Сообщений

**Выбор:** **RabbitMQ**  
**Причины:**
- Оптимальный баланс между функциональностью, надежностью и простотой  
- Подходит для учебной микросервисной архитектуры  

**Сравнительная таблица:**

| Критерий              | RabbitMQ          | Kafka          | NATS                |
|------------------------|------------------|----------------|----------------------|
| **Кластеризация**     | ✅               | ✅             | ✅                   |
| **Persistence**       | ✅               | ✅             | ✅ (JetStream)       |
| **Скорость**          | Низкая latency   | Высокая throughput | **Крайне низкая latency** |
| **Права доступа**     | ✅ (vhosts)      | ✅ (ACLs)      | ✅                   |
| **Простота эксплуатации** | Средняя      | Сложная        | **Очень простая**    |

---

## Задача 3: Практическая реализация API Gateway

### Запуск инфраструктуры

```bash
cd task-3
docker-compose up -d
```

Проверка сервисов:
```bash
docker-compose ps
```

![docker ps](https://github.com/asad-bekov/hw-32/blob/main/img/2.PNG)

---

### Тестирование API Gateway

1. **Анонимный доступ — получение токена**
   ```bash
   curl -X POST -H 'Content-Type: application/json'      -d '{"login":"bob", "password":"qwe123"}'      http://localhost:8081/v1/token
   ```
   ![token](https://github.com/asad-bekov/hw-32/blob/main/img/3.PNG)

2. **Защищенный эндпоинт — загрузка файла**
   ```bash
   curl -X POST -H 'Authorization: Bearer token'      -H 'Content-Type: octet/stream'      --data-binary @/etc/hosts      http://localhost:8081/v1/upload
   ```
   ![upload](https://github.com/asad-bekov/hw-32/blob/main/img/4.PNG)

3. **Дополнительные тесты**
   - Получение информации о пользователе:
     ```bash
     curl -X GET http://localhost:8081/v1/user
     ```
   - Регистрация пользователя:
     ```bash
     curl -X POST -H 'Content-Type: application/json'        -d '{"login":"alice", "password":"pass123"}'        http://localhost:8081/v1/register
     ```

Логи работы системы:  
![logs](https://github.com/asad-bekov/hw-32/blob/main/img/5.PNG)  
![logs](https://github.com/asad-bekov/hw-32/blob/main/img/5.1.PNG)

---

## Чеклист выполненных требований

- **Маршрутизация запросов**: Реализована через Nginx location rules  
- **Аутентификация**: Архитектура подготовлена для `auth_request`  
- **HTTPS терминация**: Конфигурация готова для добавления SSL  
- **Docker-compose**: Полная инфраструктура из 4 сервисов  
- **Тестовые сценарии**: Все эндпоинты протестированы  
- **Документация**: Полное описание решения  

---

## Рекомендации для продакшн

- **Аутентификация**: Реализовать JWT validation через `auth_request`  
- **Безопасность**: Добавить HTTPS (Let's Encrypt)  
- **Мониторинг**: Настроить Prometheus + Grafana  
- **Логирование**: Внедрить ELK stack  
- **Оркестрация**: Миграция на Kubernetes  
- **Безопасность**: Rate limiting и WAF правила  

---

## Особенности реализации

- **Модульность**: Каждый сервис в отдельном контейнере  
- **Сетевая изоляция**: Все сервисы объединены в docker network  
- **Масштабируемость**: Готовность к горизонтальному scaling  
- **Документированность**: Подробное описание архитектуры и решений  

---

